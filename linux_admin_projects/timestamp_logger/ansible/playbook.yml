
---
- name: Install Timestamp Logger
  hosts: localhost
  become: yes   # ensures tasks run as root
  tasks:

    - name: Copy log_time.sh to /usr/local/bin
      copy:
        src: files/log_time.sh
        dest: /usr/local/bin/log_time.sh
        mode: '0755'

    - name: Copy systemd unit files
      copy:
        src: files/systemd/
        dest: /etc/systemd/system/
        owner: root
        group: root
        mode: '0644'

    - name: Reload systemd to recognize new units
      command: systemctl daemon-reload

    - name: Enable and start timestamp-logger.timer
      systemd:
        name: timestamp-logger.timer
        enabled: yes
        state: started

    - name: Verify timer is active
      command: systemctl list-timers timestamp-logger.timer
      register: timer_status

    - name: Show timer status
      debug:
        msg: "{{ timer_status.stdout }}"

    - name: Run timestamp-logger service once immediately
      systemd:
        name: timestamp-logger.service
        state: restarted
